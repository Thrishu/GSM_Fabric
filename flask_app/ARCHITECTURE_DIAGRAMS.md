# System Architecture & Flow Diagrams

## Overview Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        GSM PREDICTION SYSTEM                            â”‚
â”‚                    (Adaptive Model Switching)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚   Flask Web App  â”‚
                            â”‚    (app.py)      â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚   Configuration:       â”‚
                        â”‚ MODEL_TYPE = 'pytorch' â”‚
                        â”‚   or 'catboost'        â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                         â”‚
                    â–¼                         â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   PyTorch Path       â”‚  â”‚   CatBoost Path      â”‚
        â”‚ (EfficientNet-B3)    â”‚  â”‚ (Gradient Boosting)  â”‚
        â”‚                      â”‚  â”‚                      â”‚
        â”‚ Input: Image Pixels  â”‚  â”‚ Input: Features      â”‚
        â”‚ Model: best_model    â”‚  â”‚ Model: catboost      â”‚
        â”‚ Speed: 200-500ms     â”‚  â”‚ Speed: 10-50ms       â”‚
        â”‚ Memory: 500MB        â”‚  â”‚ Memory: 50MB         â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚                         â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚   Prediction     â”‚
                        â”‚  (GSM g/mÂ²)      â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Request Flow Diagram

```
User/Client
    â”‚
    â”œâ”€ POST /api/predict (image)
    â”‚        â”‚
    â”‚        â–¼
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  â”‚ Image Preprocessing â”‚
    â”‚  â”‚ (resize, normalize) â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚             â”‚
    â”‚             â–¼
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  â”‚ Feature Extraction       â”‚
    â”‚  â”‚ (color, texture, etc.)   â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚             â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  â”‚                     â”‚
    â”‚  â–¼ (if PyTorch)        â–¼ (if CatBoost)
    â”‚  Image â†’ CNN        Features â†’ Scale â†’ CatBoost
    â”‚           â”‚                           â”‚
    â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚                         â”‚
    â”‚                         â–¼
    â”‚                   Prediction (GSM)
    â”‚                         â”‚
    â”‚                         â–¼
    â””â”€ JSON Response {gsm: 125.5, confidence: 'High'}
```

---

## Model Switching Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User sends request to switch    â”‚
â”‚  POST /api/switch-model          â”‚
â”‚  {"model_type": "catboost"}      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ Validate Type â”‚
         â”‚ (pytorch or   â”‚
         â”‚  catboost)    â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                 â”‚
   Valid?             Invalid?
        â”‚                 â”‚
        â–¼                 â–¼
    Continue         Return Error
        â”‚
        â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Check if already    â”‚
   â”‚ loaded              â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
      â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
      â”‚           â”‚
   Same?      Different?
      â”‚           â”‚
      â–¼           â–¼
   Skip      Reset Globals
      â”‚           â”‚
      â”‚     â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
      â”‚     â”‚ Load New  â”‚
      â”‚     â”‚ Model &   â”‚
      â”‚     â”‚ Scaler    â”‚
      â”‚     â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
      â”‚           â”‚
      â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Update           â”‚
    â”‚ current_model_   â”‚
    â”‚ type             â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Return Success       â”‚
    â”‚ {success: true,      â”‚
    â”‚  model_type: X,      â”‚
    â”‚  ...}                â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Feature Extraction Pipeline

```
Input Image (from user)
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Image Preprocessing         â”‚
â”‚ â€¢ Load image (CV2)          â”‚
â”‚ â€¢ Convert BGR â†’ RGB         â”‚
â”‚ â€¢ Resize to 512Ã—512 (ratio) â”‚
â”‚ â€¢ Add white padding         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Feature Extraction           â”‚
â”‚ (extract_fabric_features.py) â”‚
â”‚ â”œâ”€ Color Features            â”‚
â”‚ â”œâ”€ Texture Features          â”‚
â”‚ â”œâ”€ LBP Histograms            â”‚
â”‚ â”œâ”€ Wavelet Features          â”‚
â”‚ â”œâ”€ Edge Detection            â”‚
â”‚ â””â”€ Statistical Features      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Feature Dict   â”‚
    â”‚ {fname1: val1, â”‚
    â”‚  fname2: val2, â”‚
    â”‚  ...}          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚                    â”‚
   â–¼ (CatBoost)         â–¼ (PyTorch)
Scale Features      Use Image Directly
   â”‚                    â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Prediction Input â”‚
    â”‚ Ready            â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## CatBoost Prediction Path

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Extract Features     â”‚
â”‚ from Image           â”‚
â”‚ {fname1, fname2...}  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Create Feature Vector        â”‚
â”‚ [val1, val2, val3, ...] (N)  â”‚
â”‚ Shape: (1, num_features)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Apply RobustScaler           â”‚
â”‚ (handles outliers well)      â”‚
â”‚ [norm1, norm2, norm3, ...]   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CatBoost Model               â”‚
â”‚ (catboost_baseline.cbm)      â”‚
â”‚ â€¢ Loaded with:               â”‚
â”‚   - Feature names            â”‚
â”‚   - Pre-trained weights      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Tree Ensemble Predictions    â”‚
â”‚ â€¢ 100-1000 decision trees    â”‚
â”‚ â€¢ Each tree votes            â”‚
â”‚ â€¢ Average vote = prediction  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ GSM Prediction  â”‚
    â”‚ (float value)   â”‚
    â”‚ e.g., 125.5     â”‚
    â”‚ (g/mÂ²)          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## PyTorch CNN Prediction Path

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Load Image               â”‚
â”‚ (from uploaded file)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Preprocessing            â”‚
â”‚ â€¢ Convert BGR â†’ RGB      â”‚
â”‚ â€¢ Resize to 352Ã—352      â”‚
â”‚ â€¢ Normalize [0, 1]       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Image Tensor             â”‚
â”‚ â€¢ Convert to PyTorch     â”‚
â”‚ â€¢ Shape: (1, 3, 352, 352)â”‚
â”‚ â€¢ Type: float32          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ImageNet Normalization   â”‚
â”‚ Mean: [0.485, 0.456,     â”‚
â”‚        0.406]            â”‚
â”‚ Std:  [0.229, 0.224,     â”‚
â”‚        0.225]            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ EfficientNet-B3 Model    â”‚
â”‚ (best_model (1).pt)      â”‚
â”‚                          â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Backbone:            â”‚ â”‚
â”‚ â”‚ â€¢ Blocks 0-7         â”‚ â”‚
â”‚ â”‚ â€¢ Feature extraction â”‚ â”‚
â”‚ â”‚ â€¢ Output: 1536-dim   â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Head:                â”‚ â”‚
â”‚ â”‚ â€¢ Dropout(0.2)       â”‚ â”‚
â”‚ â”‚ â€¢ Linear(1536 â†’ 1)   â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GSM Output               â”‚
â”‚ Raw prediction value     â”‚
â”‚ (no denormalization)     â”‚
â”‚ e.g., 125.5 g/mÂ²        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## API Endpoint Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           API Endpoints (Flask Routes)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

GET /                          GET /api/health
â”‚                              â”‚
â””â”€â†’ index.html               â””â”€â†’ {status: 'healthy',
    (Web UI)                     model_type: 'pytorch',
                                 model_loaded: true,
                                 scaler_loaded: true}

POST /api/predict              GET /api/model-info
â”‚                              â”‚
â””â”€â†’ Single image               â””â”€â†’ {current_model: 'pytorch',
    {gsm, confidence,             available_models: {
     timestamp, filename}          pytorch: {...},
                                   catboost: {...}}}

POST /api/batch-predict        POST /api/switch-model
â”‚                              â”‚
â””â”€â†’ Multiple images            â””â”€â†’ {"model_type": "catboost"}
    {results: [...]}               {success: true,
                                    current_model: 'catboost'}
```

---

## State Diagram - Model Loading

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   App Initialization â”‚
                    â”‚   (startup)          â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Read MODEL_TYPE from â”‚
                    â”‚ Configuration        â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                             â”‚
                â–¼                             â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ MODEL_TYPE      â”‚         â”‚ MODEL_TYPE       â”‚
        â”‚ == 'pytorch'    â”‚         â”‚ == 'catboost'    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚                           â”‚
                 â–¼                           â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ load_pytorch_    â”‚    â”‚ load_catboost_     â”‚
        â”‚ model()          â”‚    â”‚ model()            â”‚
        â”‚ â€¢ Load .pt       â”‚    â”‚ â€¢ Load .cbm        â”‚
        â”‚ â€¢ Create arch    â”‚    â”‚ â€¢ Extract features â”‚
        â”‚ â€¢ Load weights   â”‚    â”‚ â€¢ Load scaler      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚                       â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Models Ready for â”‚
                    â”‚ Predictions      â”‚
                    â”‚ (current_model_  â”‚
                    â”‚  type set)       â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚                                 â”‚
            â–¼ (can switch at any time)        â–¼
        Accept Requests               Or switch via
                                      /api/switch-model
```

---

## Data Flow - Complete Prediction

```
User uploads image
        â”‚
        â–¼
    preprocess_image()
        â”‚
        â”œâ”€ Load with CV2
        â”œâ”€ Convert BGRâ†’RGB
        â”œâ”€ Resize (aspect ratio)
        â”œâ”€ Pad with white
        â”‚
        â–¼
    extract_features()
        â”‚
        â”œâ”€ Extract color features
        â”œâ”€ Extract texture features
        â”œâ”€ Extract shape features
        â”‚
        â–¼
    predict_gsm()
        â”‚
        â”œâ”€ Check current_model_type
        â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                 â”‚                 â”‚
        â–¼ pytorch         â–¼ catboost        â”‚
    Load imageâ†’      Create feature         â”‚
    Resize 352x352    vector                â”‚
        â”‚                 â”‚                 â”‚
        â”œâ”€ Normalize      â”œâ”€ Scale features â”‚
        â”œâ”€ ImageNet       â”œâ”€ Reshape        â”‚
        â”‚  norm           â”‚                 â”‚
        â”‚                 â”‚                 â”‚
        â–¼                 â–¼                 â”‚
    CNN Forward       CatBoost Predict     â”‚
    Pass                                    â”‚
        â”‚                                   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
                Return GSM value
                        â”‚
                        â–¼
            Send JSON Response
            {gsm: xxx, confidence: xxx}
```

---

## Configuration Change Flow

```
Want to use CatBoost?
        â”‚
        â”œâ”€ Option A (Startup)
        â”‚   â”œâ”€ Edit app.py
        â”‚   â”œâ”€ Set MODEL_TYPE = 'catboost'
        â”‚   â”œâ”€ Restart app
        â”‚   â””â”€ Done!
        â”‚
        â””â”€ Option B (Runtime)
            â”œâ”€ App already running
            â”œâ”€ Call /api/switch-model
            â”œâ”€ Unload current model
            â”œâ”€ Load CatBoost model
            â”œâ”€ Update current_model_type
            â””â”€ Continue without restart!
```

---

## Comparison Matrix

```
                    PyTorch CNN      â”‚      CatBoost
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Input               Image pixels      â”‚      Extracted features
Architecture        EfficientNet-B3   â”‚      Gradient Boosting
Number of params    ~12 million       â”‚      ~100K-1M
Training data       Images            â”‚      Feature vectors
Prediction speed    200-500ms         â”‚      10-50ms
Memory (model)      ~400MB            â”‚      ~10MB
Memory (inference)  ~500MB total      â”‚      ~50MB total
GPU support         Yes               â”‚      No (CPU only)
Interpretability    Low               â”‚      Medium (feature importance)
Robustness          High              â”‚      Very High
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
```

---

## File Organization Diagram

```
flask_app/
â”‚
â”œâ”€â”€ app.py âœ“ MODIFIED
â”‚   â”œâ”€ Added MODEL_TYPE config
â”‚   â”œâ”€ Added load_catboost_model()
â”‚   â”œâ”€ Added predict_gsm_catboost()
â”‚   â”œâ”€ Added /api/switch-model
â”‚   â”œâ”€ Added /api/model-info
â”‚   â””â”€ Enhanced /api/health
â”‚
â”œâ”€â”€ extract_fabric_features.py (unchanged)
â”œâ”€â”€ requirements.txt (unchanged)
â”‚
â”œâ”€â”€ Documentation (NEW) â­
â”‚   â”œâ”€ README_MODEL_SWITCHING.md
â”‚   â”œâ”€ QUICKSTART.md
â”‚   â”œâ”€ MODEL_SWITCHING_GUIDE.md
â”‚   â”œâ”€ CONFIG_TEMPLATE.md
â”‚   â”œâ”€ IMPLEMENTATION_SUMMARY.md
â”‚   â””â”€ ARCHITECTURE_DIAGRAMS.md (this file)
â”‚
â”œâ”€â”€ Tools (NEW) ğŸ”§
â”‚   â”œâ”€ model_switch_utility.py
â”‚   â””â”€ model_comparison.py
â”‚
â””â”€â”€ Web UI (unchanged)
    â”œâ”€ templates/index.html
    â”œâ”€ static/style.css
    â””â”€ uploads/
```

---

This architecture supports seamless switching while maintaining full backward compatibility! ğŸš€
